<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™¶Â·è¯­ - å±±ä¸œå½©é™¶å™äº‹å¯è§†åŒ–</title>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d7ccc8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #8d6e63; }
        
        /* Typography overrides for "larger and bolder" feel */
        body { font-family: 'Noto Serif SC', serif; }
        .font-reading { font-size: 1.125rem; line-height: 1.75rem; } /* text-lg */
        .font-header { font-weight: 900; }
    </style>
</head>
<body class="bg-[#f5f5f0] text-[#4e342e] font-serif overflow-hidden selection:bg-[#8d6e63] selection:text-white">

    <!-- Main Container -->
    <div id="app-container" class="w-full h-screen relative overflow-hidden bg-[#f5f5f0]">
        
        <!-- MODE 1: Story Mode (Scrollytelling Overlay) -->
        <div id="story-overlay" class="absolute inset-0 z-50 pointer-events-none flex flex-col">
            
            <!-- Story Sections Container -->
            <div id="story-scroller" class="w-full h-full overflow-y-auto pointer-events-auto snap-y snap-mandatory scroll-smooth">
                
                <!-- Section 1: Hero -->
                <div class="story-section w-full h-screen flex items-center justify-center snap-start relative" data-step="1">
                    <div class="bg-white/95 backdrop-blur-xl p-16 rounded-2xl shadow-2xl max-w-3xl text-center border-t-8 border-[#8d6e63]">
                        <h1 class="text-6xl font-black text-[#3e2723] mb-8 tracking-wider">é™¶ Â· è¯­</h1>
                        <div class="w-32 h-2 bg-[#8d6e63] mx-auto mb-10 rounded-full"></div>
                        <p class="text-2xl text-[#5d4037] italic mb-10 leading-loose font-medium">
                            â€œæˆ‘æ˜¯ä¸€ä»¶æ¥è‡ª<span id="hero-era" class="font-bold text-[#8d6e63] px-1">æ–°çŸ³å™¨æ—¶ä»£</span>çš„<span id="hero-shape" class="font-bold text-[#8d6e63] px-1">å½©é™¶</span>ã€‚<br>
                            åœ¨è¿™é‡Œï¼Œæˆ‘ä¸åªæ˜¯ä¸€ä¸ªæ•°æ®ç‚¹ï¼Œæˆ‘æœ‰æˆ‘çš„æ•…äº‹ã€‚â€
                        </p>
                        <div class="flex justify-center space-x-12 text-base text-[#8d6e63] font-bold uppercase tracking-[0.2em] mb-12">
                            <span>å¤§æ±¶å£æ–‡åŒ–</span>
                            <span>â€¢</span>
                            <span>é¾™å±±æ–‡åŒ–</span>
                            <span>â€¢</span>
                            <span>å²³çŸ³æ–‡åŒ–</span>
                        </div>
                        <div class="animate-bounce text-[#8d6e63] flex flex-col items-center cursor-pointer opacity-80 hover:opacity-100">
                            <span class="text-sm font-bold mb-2">å‘ä¸‹æ¢ç´¢</span>
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Identity -->
                <div class="story-section w-full h-screen flex items-center px-32 snap-start" data-step="2">
                    <div class="w-[500px] bg-white/95 backdrop-blur-xl shadow-2xl p-10 rounded-xl border-l-[12px] border-[#8d6e63] transform transition-all duration-700 translate-x-0 opacity-100">
                        <h2 class="text-4xl font-black text-[#3e2723] mb-6">æˆ‘æ˜¯è°ï¼Ÿ</h2>
                        <div class="w-64 h-64 mx-auto bg-[#efebe9] rounded-full mb-8 overflow-hidden border-[6px] border-[#8d6e63] shadow-inner relative group">
                            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition z-10"></div>
                            <img id="story-protagonist-img" src="" class="object-cover w-full h-full transform group-hover:scale-110 transition duration-1000">
                        </div>
                        <p class="text-2xl text-[#4e342e] mb-6 text-center font-bold">
                            æˆ‘å« <span id="story-protagonist-name" class="text-[#8d6e63] underline decoration-2 underline-offset-4"></span>ã€‚
                        </p>
                        <p class="text-lg text-[#5d4037] leading-relaxed text-justify font-medium" id="story-protagonist-desc">
                            <!-- Description -->
                        </p>
                    </div>
                </div>

                <!-- Section 3: The World -->
                <div class="story-section w-full h-screen flex items-center justify-end px-32 snap-start" data-step="3">
                    <div class="w-[450px] bg-white/95 backdrop-blur-xl shadow-2xl p-10 rounded-xl border-r-[12px] border-[#8d6e63]">
                        <h2 class="text-4xl font-black text-[#3e2723] mb-6">æˆ‘çš„å®¶æ—</h2>
                        <p class="text-xl text-[#5d4037] mb-8 font-medium leading-relaxed">
                            åœ¨å±±ä¸œè¿™ç‰‡å¹¿è¢¤çš„åœŸåœ°ä¸Šï¼Œæˆ‘å¹¶ä¸å­¤å•ã€‚
                        </p>
                        <div class="space-y-6">
                            <div class="flex items-center justify-between border-b-2 border-[#d7ccc8] pb-3">
                                <span class="text-base font-bold text-[#8d6e63]">åŒç±»æ•°é‡</span>
                                <span class="text-4xl font-black text-[#3e2723]" id="story-family-count">0</span>
                            </div>
                            <div class="flex items-center justify-between border-b-2 border-[#d7ccc8] pb-3">
                                <span class="text-base font-bold text-[#8d6e63]">ä¸»è¦åˆ†å¸ƒ</span>
                                <span class="text-2xl font-black text-[#3e2723]" id="story-family-city">...</span>
                            </div>
                        </div>
                        <p class="mt-8 text-base text-[#5d4037] italic font-medium bg-[#efebe9] p-4 rounded-lg border-l-4 border-[#8d6e63]">
                            â€œçœ‹ï¼Œåœ°å›¾ä¸Šé‚£äº›é—ªçƒçš„å…‰ç‚¹ï¼Œéƒ½æ˜¯æˆ‘çš„å…„å¼Ÿå§å¦¹ã€‚â€
                        </p>
                    </div>
                </div>

                <!-- Section 4: Transition -->
                <div class="story-section w-full h-screen flex items-center justify-center snap-start" data-step="4">
                    <div class="bg-white/95 backdrop-blur-xl p-16 rounded-2xl shadow-2xl text-center max-w-2xl border-b-8 border-[#8d6e63]">
                        <h2 class="text-4xl font-black text-[#3e2723] mb-8">æ¢ç´¢æ›´å¤š</h2>
                        <p class="text-xl text-[#5d4037] mb-10 leading-relaxed font-medium">
                            æ¯ä¸€ä¸ªå…‰ç‚¹èƒŒåï¼Œéƒ½æœ‰ä¸€æ®µå°˜å°çš„å†å²ã€‚<br>
                            ç°åœ¨ï¼Œäº¤ç»™ä½ æ¥æ¢ç´¢è¿™ä¸ªä¸–ç•Œã€‚
                        </p>
                        <button onclick="app.enterExploreMode()" class="px-12 py-4 bg-[#8d6e63] text-white text-xl font-bold rounded-full shadow-lg hover:bg-[#6d4c41] transition transform hover:scale-105 hover:shadow-xl ring-4 ring-[#d7ccc8] ring-opacity-50">
                            è¿›å…¥è‡ªç”±æ¢ç´¢æ¨¡å¼
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- MODE 2: Explore Mode -->
        <div id="explore-interface" class="w-full h-full flex flex-col opacity-0 transition-opacity duration-1000 pointer-events-none">
            <!-- TOP: Main Visual Area -->
            <div class="flex-1 flex overflow-hidden">
                
                <!-- LEFT: Narrative Gallery -->
                <div class="w-[500px] h-full bg-[#fcfbfb] border-r border-[#d7ccc8] flex flex-col shadow-2xl z-20 transition-transform duration-500 transform -translate-x-full" id="explore-sidebar">
                    <!-- Gallery Header -->
                    <div class="p-6 bg-[#8d6e63] text-white shadow-lg flex justify-between items-center z-10">
                        <div>
                            <h1 class="text-3xl font-black mb-1 tracking-wide">é™¶ Â· è¯­</h1>
                            <p class="text-sm opacity-90 italic font-medium">è‡ªç”±æ¢ç´¢æ¨¡å¼</p>
                        </div>
                        <button onclick="app.toggleAnalytics()" class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition font-bold text-sm backdrop-blur-sm border border-white/10">
                            <span>ğŸ“Š</span>
                            <span>æ•°æ®çœ‹æ¿</span>
                        </button>
                    </div>

                    <!-- Spotlight Section -->
                    <div id="gallery-spotlight" class="p-8 border-b border-[#d7ccc8] bg-white relative text-center shadow-sm z-0">
                        <div class="w-56 h-56 mx-auto bg-stone-100 rounded-full overflow-hidden shadow-xl mb-6 border-[6px] border-[#efebe9] relative group cursor-zoom-in">
                            <img id="spot-img" src="" class="object-cover w-full h-full transition-transform duration-700 group-hover:scale-110">
                        </div>
                        <h2 id="spot-title" class="text-3xl font-black text-[#3e2723] mb-2">...</h2>
                        <div class="flex justify-center space-x-4 text-sm text-[#8d6e63] font-bold mb-4 uppercase tracking-wider">
                            <span id="spot-museum" class="bg-[#efebe9] px-2 py-1 rounded">åšç‰©é¦†</span>
                            <span id="spot-shape" class="bg-[#efebe9] px-2 py-1 rounded">å™¨å‹</span>
                        </div>
                        <p id="spot-desc" class="text-base text-[#5d4037] leading-relaxed text-justify font-medium line-clamp-4 px-2">...</p>
                    </div>

                    <!-- Filter & List -->
                    <div class="flex-1 flex flex-col overflow-hidden bg-[#fafafa]">
                        <div class="px-6 py-3 border-b border-[#d7ccc8] bg-[#efebe9] flex justify-between items-center shadow-inner">
                            <span class="text-sm font-black uppercase text-[#8d6e63] tracking-wider">æ–‡ç‰©åˆ—è¡¨</span>
                            <span id="list-count" class="text-sm font-bold bg-[#8d6e63] text-white px-3 py-1 rounded-full shadow-sm">0</span>
                        </div>
                        <div id="gallery-list" class="flex-1 overflow-y-auto p-4 grid grid-cols-2 gap-4 content-start">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Interactive Map -->
                <div class="flex-1 h-full relative bg-[#f5f5f0]">
                    <div id="map" class="w-full h-full"></div>
                    
                    <!-- Floating Control Panel -->
                    <div class="absolute top-8 right-8 bg-white/95 backdrop-blur-xl shadow-2xl rounded-xl border border-[#d7ccc8] p-6 w-72 transition-transform duration-500 transform translate-x-full" id="explore-controls">
                        <h3 class="font-black text-[#3e2723] mb-4 border-b-2 border-[#efebe9] pb-2 text-base flex items-center">
                            <span class="w-2 h-6 bg-[#8d6e63] rounded-full mr-2"></span>å™¨å‹ç­›é€‰
                        </h3>
                        <div id="shape-filters" class="flex flex-wrap gap-2 mb-6">
                            <!-- Buttons populated by JS -->
                        </div>
                        
                        <h3 class="font-black text-[#3e2723] mb-4 border-b-2 border-[#efebe9] pb-2 pt-2 text-base flex items-center">
                             <span class="w-2 h-6 bg-[#8d6e63] rounded-full mr-2"></span>åœ°å›¾æ¨¡å¼
                        </h3>
                        <div class="flex bg-[#efebe9] rounded-lg p-1.5 shadow-inner mb-6">
                            <button class="flex-1 py-2 text-sm font-bold rounded-md shadow-sm bg-white text-[#5d4037] transition" id="btn-mode-count" onclick="app.setMapMode('count')">è—é‡çƒ­åŠ›</button>
                            <button class="flex-1 py-2 text-sm font-bold rounded-md text-stone-500 hover:text-[#5d4037] transition" id="btn-mode-clicks" onclick="app.setMapMode('clicks')">å…³æ³¨çƒ­åº¦</button>
                        </div>

                        <!-- Timeline Slider -->
                        <h3 class="font-black text-[#3e2723] mb-4 border-b-2 border-[#efebe9] pb-2 pt-2 text-base flex items-center">
                             <span class="w-2 h-6 bg-[#8d6e63] rounded-full mr-2"></span>æ—¶ç©ºæ¼”åŒ–
                        </h3>
                        <div class="px-2 pb-2">
                            <input type="range" min="0" max="2" step="1" value="0" class="w-full h-2 bg-[#d7ccc8] rounded-lg appearance-none cursor-pointer accent-[#8d6e63]" id="timeline-slider" oninput="app.updateTimeline(this.value)">
                            <div class="flex justify-between text-xs text-[#8d6e63] mt-2 font-bold uppercase tracking-widest">
                                <span>å¤§æ±¶å£</span>
                                <span>è¿‡æ¸¡</span>
                                <span>é¾™å±±</span>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Legend -->
                    <div class="absolute bottom-8 right-8 bg-white/90 backdrop-blur-md shadow-lg rounded-xl border border-[#d7ccc8] p-4 text-sm opacity-0 transition-opacity duration-1000" id="explore-legend">
                        <div class="flex items-center mb-2">
                            <span class="w-4 h-4 bg-[#bcaaa4] rounded-full mr-3 border-2 border-white shadow-sm"></span> 
                            <span class="font-bold text-[#5d4037]">åŒååˆ†å¸ƒç‚¹</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full border-2 border-[#8d6e63] bg-stone-100 mr-3 flex items-center justify-center overflow-hidden">
                                <span class="text-[8px]">å›¾</span>
                            </div>
                            <span class="font-bold text-[#5d4037]">æ–‡ç‰©å®ä½“</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOTTOM: Analytics Dashboard (Collapsible) -->
            <div id="analytics-panel" class="h-0 bg-[#fafafa] border-t-4 border-[#8d6e63] transition-all duration-700 ease-in-out overflow-hidden shadow-[0_-10px_40px_-10px_rgba(0,0,0,0.2)] z-30 relative">
                
                <!-- Close Button -->
                <button onclick="app.toggleAnalytics()" class="absolute top-4 right-4 p-2 hover:bg-[#efebe9] rounded-full transition text-[#8d6e63]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>

                <div class="h-[400px] p-8 flex space-x-10 max-w-[1600px] mx-auto">
                    <!-- Chart 1: 3-Level Sankey -->
                    <div class="flex-1 flex flex-col bg-white p-4 rounded-xl shadow-sm border border-[#efebe9]">
                        <h3 class="text-lg font-black text-[#5d4037] mb-4 flex items-center">
                            <span class="bg-[#8d6e63] text-white w-6 h-6 rounded flex items-center justify-center text-xs mr-2">1</span>
                            æ—¶ç©ºæµå˜ (æ—¶ä»£ â†’ åŸå¸‚ â†’ å™¨å‹)
                        </h3>
                        <div id="chart-sankey" class="flex-1 w-full rounded"></div>
                    </div>
                    
                    <!-- Chart 2: Parallel Coordinates -->
                    <div class="flex-1 flex flex-col bg-white p-4 rounded-xl shadow-sm border border-[#efebe9]">
                        <h3 class="text-lg font-black text-[#5d4037] mb-4 flex items-center">
                            <span class="bg-[#8d6e63] text-white w-6 h-6 rounded flex items-center justify-center text-xs mr-2">2</span>
                            å¤šç»´ç‰¹å¾åˆ†æ (å¹´ä»£/ç±»å‹/çƒ­åº¦)
                        </h3>
                        <div id="chart-parallel" class="flex-1 w-full rounded"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="script.js"></script>
</body>
</html>